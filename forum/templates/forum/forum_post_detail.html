{% extends "app/base.html" %}

{% block main_content %}
{% load static %}

<link rel="stylesheet" type="text/css" href="{% static 'forum.css' %}">

<div class="mt-3">
  <button class="back-to-forum-btn" onclick="window.location.href='{% url 'forum-post-list' %}'">
    Quay lại Diễn đàn
  </button>
</div>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-12">
      {% if post.username == user %}
        <br>
        <button class="btn btn-warning" onclick="window.location.href='{% url 'edit-post' post.id %}'">Sửa</button>
        <button class="btn btn-danger" onclick="window.location.href='{% url 'delete-post' post.id %}'">Xóa</button>
      {% endif %}
      <h1 class="mb-4">{{ post.title }}</h1>
      <div class="text-muted mb-3"><i>Ngày đăng: {{ post.created_at|date:"d/m/Y h:m" }}</i></div>
      <div class="mb-3"><b>Đăng bởi:</b> {{ post.username }}</div>
      
      <div class="border rounded p-3 mb-4">
        <p>{{ post.content|safe }}</p>
      </div>

      {% if user.username %}
      <div class="comment-section mt-5 mb-4 ">
        <h2>Thêm Bình Luận</h2>
        <form method="post" action="{% url 'add-comment-to-post' post.id %}" autocomplete="off">
          {% csrf_token %}
          <div class="row">
            <div class="col"> {{ comment_form }} </div>
          </div>
          <button type="submit" class="btn btn-primary">Đăng Bình Luận</button>
        </form>
      </div>
      {% else %}
      <div class="mt-5 mb-4"><button onclick="loadLoginForm()" class="btn btn-primary">Đăng nhập</button> để bình luận</div>
      {% endif %}

      <h2 class="mt-5 mb-4">Bình luận</h2>
      {% for comment in comments %}
      <div class="card mb-3">
        <div class="card-body">
          <div><b>Người đăng:</b> {{ comment.username }}</div>
          <div class="text-muted"><i>{{ comment.created_at|date:"d/m/Y h:m" }}</i></div>
          <hr>
          <p class="card-text">{{ comment.content|linebreaks }}</p>
        </div>
      </div>
      {% endfor %}

    </div>
  </div>
</div>

{% endblock main_content %}